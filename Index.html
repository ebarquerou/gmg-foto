<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document Scanner</title>
  <script src="https://docs.opencv.org/4.7.0/opencv.js" async></script>
  <!-- warning: loading OpenCV can take some time. Load asynchronously -->
  <script src="https://cdn.jsdelivr.net/gh/ColonelParrot/jscanify@master/src/jscanify.min.js"></script>  
  </head>
<body>
  <div class="home">
    <h1>Escanear Documento</h1>
    <video id="video" width="320" height="240" autoplay></video>
    <button id="capture">Escanear</button>
    <canvas id="canvas" style="display:none;"></canvas>
    <img id="output" alt="Escaneo" />


    <canvas id="result"></canvas>
    <!-- highlighted video -->
</body>
<script>
    // Obtener acceso a la c치mara y listar opciones
    async function getCameraOptions() {
        const devices = await navigator.mediaDevices.enumerateDevices();
        const videoDevices = devices.filter(device => device.kind === 'videoinput');
        return videoDevices;
    }

    // Configurar la c치mara y el escaneo
    async function setupCamera() {
        const video = document.getElementById('video');
        const options = await getCameraOptions();
        if (options.length === 0) {
            alert('No se encontraron c치maras.');
            return;
        }

        const constraints = {
            video: {
                deviceId: options[0].deviceId
            }
        };

        navigator.mediaDevices.getUserMedia(constraints)
            .then(stream => {
                video.srcObject = stream;
            })
            .catch(err => {
                console.error('Error al acceder a la c치mara:', err);
            });
    }    
    
    document.getElementById('capture').addEventListener('click', () => {
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');

            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            const dataURL = canvas.toDataURL('image/png');

            // Utilizar jscanify para procesar la imagen
            const js = new jscanify.Jscanify();
            js.processImage(dataURL).then(processedImage => {
                document.getElementById('output').src = processedImage;
            }).catch(error => {
                console.error('Error procesando la imagen:', error);
            });
        });
    
    window.addEventListener('load', setupCamera);



  // document.getElementById('startButton').addEventListener('click', () => {
  //   const scanner = new jscanify();
  //   const video = document.getElementById('video');
  //   const canvas = document.getElementById('canvas');
  //   const result = document.getElementById('result');
  //   const canvasCtx = canvas.getContext('2d');
  //   const resultCtx = result.getContext('2d');

  //   navigator.mediaDevices.getUserMedia({ video: true }).then((stream) => {
  //     video.srcObject = stream;
  //     video.onloadedmetadata = () => {
  //       video.play();

  //       setInterval(() => {
  //         canvasCtx.drawImage(video, 0, 0);
  //         const resultCanvas = scanner.highlightPaper(canvas);
  //         resultCtx.drawImage(resultCanvas, 0, 0);
  //       }, 10);
  //     };
  //   }).catch((err) => {
  //     console.error('Error accessing media devices.', err);
  //   });
  // });
</script>

</html>